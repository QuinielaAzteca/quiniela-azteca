<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quiniela Azteca ‚Äì Monitor</title>

<style>
:root{
  --fg:#0f172a;
  --muted:#475569;

  --bg:#eaf3ee;
  --bg2:#dfeee7;
  --card:#ffffff;
  --line:#d7e6dc;

  --rowA:#f6fbf8;
  --rowB:#eff7f2;

  --shadow: 0 10px 24px rgba(2,44,20,.10);

  /* ‚úÖ columnas */
  --wFolio: 56px;
  --wNombre: 1fr;
  --wSel: 28px;
  --wA: 28px;

  /* ‚úÖ colores */
  --hitBg:#22c55e;      /* ‚Äúsemaforo‚Äù */
  --hitTx:#062a16;

  /* 1¬∞ / 2¬∞ en grises */
  --win1Bg:#e5e7eb;
  --win2Bg:#f3f4f6;
  --winTx:#0f172a;

  --pillBd:#cbd5e1;
  --pillBg:#ffffff;
}

*{box-sizing:border-box}
html{ -webkit-text-size-adjust:100%; text-size-adjust:100%; }
html,body{ height:100%; }
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  color:var(--fg);
  background: radial-gradient(1200px 520px at 50% -140px, #ffffff 0%, var(--bg) 55%, var(--bg2) 100%);
  overflow-x:hidden; /* ‚úÖ evita el ‚Äúespacio raro‚Äù a la derecha */
}
a, a:visited{ color:inherit; text-decoration:none; } /* ‚úÖ quita subrayados raros */

/* ===== HEADER STICKY (todo lo de arriba fijo) ===== */
.header{
  position:sticky;
  top:0;
  z-index:50;
  background:#fff;
  border-bottom:1px solid rgba(215,230,220,.85);
  box-shadow: 0 10px 24px rgba(2,6,23,.05);
}
.header-inner{
  max-width:1100px;
  margin:auto;
  padding:10px 12px 10px;
}
.card{
  border:1px solid var(--line);
  border-radius:16px;
  overflow:hidden;
  background:linear-gradient(180deg, #ffffff 0%, #fbfdfc 100%);
  box-shadow:var(--shadow);
}
.bar{
  height:6px;
  background:linear-gradient(90deg,#0a6b3a 0%, #0a6b3a 33%, #ffffff 33%, #ffffff 66%, #c62828 66%, #c62828 100%);
}
.cardPad{ padding:10px 10px 8px; }

.brandRow{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
  margin-bottom:8px;
}
.title{
  margin:0;
  font-weight:1000;
  letter-spacing:.04em;
  line-height:1.05;
  font-size:18px;
}
.title .g{ color:#0a6b3a; }
.title .r{ color:#c62828; }
.week{
  margin-top:2px;
  font-size:12px;
  font-weight:900;
  color:var(--muted);
}

/* ===== PARTIDOS ===== */
.partidos{
  display:flex;
  flex-direction:column;
  gap:6px;
  margin-top:6px;
}
.p{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding:6px 10px;
  border-radius:14px;
  background: var(--rowA);
  border:1px solid rgba(215,230,220,.55);
}
.p:nth-child(even){ background: var(--rowB); }
.p .left{
  flex:1;
  min-width:0;
  font-size:12px;
  font-weight:900;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.p .right{
  flex-shrink:0;
  display:flex;
  gap:8px;
  align-items:center;
  white-space:nowrap;
}
.chip{
  padding:4px 10px;
  border-radius:999px;
  border:1px solid #e5e7eb;
  background:#f8fafc;
  font-size:12px;
  font-weight:1000;
  line-height:1;
}
.chip.pick{
  background:#ecfdf5;
  border-color:#bbf7d0;
  color:#065f46;
}

/* ===== BUSCADOR ===== */
.searchRow{
  margin-top:10px;
  display:flex;
  gap:10px;
  align-items:stretch;
}
.search{
  position:relative;
  flex:1;
}
.search::before{
  content:"üîç";
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  font-size:16px;
  opacity:.7;
}
.search input{
  width:100%;
  padding:12px 12px 12px 40px;
  font-size:16px;
  font-weight:900;
  border:2px solid #cbd5e1;
  border-radius:16px;
  outline:none;
  background:#fff;
}
.search input:focus{ border-color:#94a3b8; }

/* ===== NAV SIMPLE (arriba) ===== */
.navTop{
  margin-top:10px;
  display:grid;
  grid-template-columns: 1fr auto 1fr;
  align-items:center;
  gap:10px;
  padding:10px;
  border:1px solid rgba(215,230,220,.8);
  border-radius:16px;
  background: rgba(248,250,252,.95);
}
.navBtn{
  justify-self:start;
  width:64px;
  height:54px;
  border-radius:18px;
  border:2px solid #cbd5e1;
  background:#fff;
  font-weight:1000;
  font-size:22px;
  line-height:1;
}
.navBtn.right{ justify-self:end; }
.navBtn:active{ transform:scale(.98); }
.navCenter{
  text-align:center;
  font-weight:1000;
  color:var(--fg);
}
.navCenter .pnum{ font-size:26px; letter-spacing:.02em; }
.navCenter .tot{ font-size:14px; color:var(--muted); margin-top:2px; }

/* ===== HEAD FIJO DEL LISTADO ===== */
.headRow{
  margin-top:10px;
  border:1px solid var(--line);
  border-radius:16px;
  overflow:hidden;
  background:#f8fafc;
}
.headGrid{
  display:grid;
  grid-template-columns: var(--wFolio) var(--wNombre) repeat(9, var(--wSel)) var(--wA);
  align-items:center;
  padding-right: var(--sbw, 0px); /* ‚úÖ compensa scrollbar si aparece */
}
.hc{
  padding:10px 8px;
  border-right:1px solid rgba(215,230,220,.8);
  font-size:14px;
  font-weight:1000;
  text-align:center;
}
.hc:last-child{ border-right:none; }
.hc.left{ text-align:left; }
.hc.fn{ font-size:14px; }

/* ===== CONTENEDOR LISTA ===== */
.wrap{
  max-width:1100px;
  margin:0 auto;
  padding:12px 12px 18px;
}
.listBox{
  border:1px solid var(--line);
  border-radius:16px;
  overflow:auto;
  background:#fff;
  box-shadow:var(--shadow);
  height: calc(100vh - 420px); /* ‚úÖ ajusta ‚Äúautom√°tico‚Äù debajo del header */
  min-height:240px;
  overscroll-behavior: contain;
}
.listBox::after{
  content:"";
  display:block;
  height: calc(84px + env(safe-area-inset-bottom));
}

/* filas */
.row{
  display:grid;
  grid-template-columns: var(--wFolio) var(--wNombre) repeat(9, var(--wSel)) var(--wA);
  align-items:center;
  gap:0;
  border-bottom:1px solid #e2eee8;
  padding-right: var(--sbw, 0px); /* ‚úÖ mismo padding que el head */
}
.row:nth-child(even){ background:#fbfdff; }

.row.win1{ background:var(--win1Bg); color:var(--winTx); }
.row.win2{ background:var(--win2Bg); color:var(--winTx); }

.cell{
  padding:10px 8px;
  font-size:14px;
  font-weight:900;
  text-align:center;
}
.cell.folio{
  text-align:right;
  color:#334155;
  font-weight:800;
}
.cell.name{
  text-align:left;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.cell.ac{
  font-weight:1000;
}

/* selecciones */
.pill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:26px;
  height:26px;
  border-radius:999px;
  border:1px solid var(--pillBd);
  background:var(--pillBg);
  font-size:14px;
  font-weight:1000;
  line-height:1;
}
.pill.hit{
  background: color-mix(in srgb, var(--hitBg) 25%, #ffffff 75%);
  border-color: color-mix(in srgb, var(--hitBg) 55%, #ffffff 45%);
  color: var(--hitTx);
}

/* cargando / sin coincidencias */
.msg{
  margin:10px 0 0;
  padding:10px 12px;
  border:1px solid rgba(215,230,220,.85);
  border-radius:14px;
  background: rgba(248,250,252,.95);
  color:var(--muted);
  font-size:13px;
  font-weight:900;
  text-align:center;
}
.msg[hidden]{ display:none; }

/* responsive */
@media (max-width:520px){
  :root{ --wFolio: 52px; --wSel: 26px; --wA: 26px; }
  .title{ font-size:16px; }
  .p .left{ font-size:11px; }
  .chip{ font-size:11px; padding:3px 8px; }
  .search input{ font-size:15px; padding:11px 12px 11px 40px; }
  .hc{ font-size:13px; padding:9px 6px; }
  .cell{ font-size:13px; padding:9px 6px; }
  .pill{ width:24px; height:24px; font-size:13px; }
  .navBtn{ width:60px; height:52px; border-radius:18px; }
}
@media (max-width:420px){
  :root{ --wFolio: 50px; --wSel: 24px; --wA: 24px; }
  .hc.fn{ font-size:13px; }
  .pill{ width:22px; height:22px; font-size:12px; }
}
</style>
</head>

<body>

<div class="header" id="header">
  <div class="header-inner">
    <div class="card">
      <div class="bar"></div>
      <div class="cardPad">

        <div class="brandRow">
          <div>
            <div class="title"><span class="g">QUINIELA</span> <span class="r">AZTECA</span></div>
            <div class="week" id="weekTxt"></div>
          </div>
        </div>

        <div class="partidos" id="partidosTxt"></div>

        <div class="searchRow">
          <div class="search">
            <input id="searchInput" placeholder="Busca aqu√≠ por tel√©fono, nombre o folio" autocomplete="off" inputmode="search">
          </div>
        </div>

        <!-- NAV ARRIBA (simple como tu captura) -->
        <div class="navTop">
          <button class="navBtn" id="btnPrev" aria-label="Anterior">‚óÄ</button>
          <div class="navCenter">
            <div class="pnum" id="pageTxt">1 / 1</div>
            <div class="tot" id="totalTxt">0 registros</div>
          </div>
          <button class="navBtn right" id="btnNext" aria-label="Siguiente">‚ñ∂</button>
        </div>

        <div class="msg" id="loadingMsg" hidden>Cargando‚Ä¶</div>
        <div class="msg" id="noMatchMsg" hidden>Sin coincidencias</div>

        <!-- ‚úÖ ESTA FILA QUEDA FIJA (est√° dentro del header sticky) -->
        <div class="headRow" aria-hidden="true">
          <div class="headGrid" id="headGrid">
            <div class="hc fn">Folio / Nombre</div>
            <div class="hc left" style="display:none"></div><!-- placeholder (no se usa) -->
            <div class="hc">1</div><div class="hc">2</div><div class="hc">3</div><div class="hc">4</div><div class="hc">5</div>
            <div class="hc">6</div><div class="hc">7</div><div class="hc">8</div><div class="hc">9</div>
            <div class="hc">A</div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="listBox" id="listBox">
    <div id="list"></div>
  </div>
</div>

<script>
const BASE = "https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";
const PAGE_SIZE = 500;

let page = 1;
let totalPages = 1;
let totalRows = 0;

let resultados = Array(9).fill(""); // L/E/V (para colorear aciertos)
let marcadores = Array(9).fill("");

const $ = (id) => document.getElementById(id);

function showLoading(on){
  $("loadingMsg").hidden = !on;
}
function showNoMatch(on){
  $("noMatchMsg").hidden = !on;
}

function norm(v){ return String(v ?? "").trim().toUpperCase(); }

function syncScrollbarWidth(){
  const box = $("listBox");
  if (!box) return;
  const sbw = box.offsetWidth - box.clientWidth;
  document.documentElement.style.setProperty("--sbw", sbw + "px");
}
window.addEventListener("resize", syncScrollbarWidth, {passive:true});

function setPageText(){
  $("pageTxt").textContent = `${page} / ${totalPages}`;
  $("totalTxt").textContent = `${Number(totalRows||0).toLocaleString("es-MX")} registros`;

  // botones
  $("btnPrev").disabled = (page <= 1);
  $("btnNext").disabled = (page >= totalPages);

  $("btnPrev").style.opacity = $("btnPrev").disabled ? .4 : 1;
  $("btnNext").style.opacity = $("btnNext").disabled ? .4 : 1;
}

function renderPartidos(cfg){
  const partidos = (cfg.partidos || []).slice(0,9);
  const box = $("partidosTxt");
  box.innerHTML = "";

  partidos.forEach((p,i)=>{
    const m = (marcadores[i] && String(marcadores[i]).trim()) ? String(marcadores[i]).trim() : "-";
    const r = (resultados[i] && String(resultados[i]).trim()) ? String(resultados[i]).trim().toUpperCase() : "-";

    const div = document.createElement("div");
    div.className = "p";
    div.innerHTML = `
      <span class="left">${i+1} ${p.local} vs ${p.visita}</span>
      <span class="right">
        <span class="chip">${m}</span>
        <span class="chip pick">${r}</span>
      </span>
    `;
    box.appendChild(div);
  });
}

async function loadConfig(){
  try{
    const res = await fetch(`${BASE}?mode=config`, {cache:"no-store"});
    const j = await res.json();
    const cfg = (j && j.cfg) ? j.cfg : {};

    $("weekTxt").textContent = cfg.subtitulo || "";

    resultados = (cfg.resultados || []).slice(0,9).map(norm);
    marcadores = (cfg.marcadores || []).slice(0,9);

    renderPartidos(cfg);
  }catch(e){
    // si falla config, igual dejamos la UI viva
  }
}

function rowClassByPlace(r){
  // Soporta cualquiera de estas formas:
  // - r._lugar (1/2/0)
  // - r.place  (1/2/0)
  // - r[??] no (mejor no asumir)
  const lugar = (typeof r === "object" && r) ? (r._lugar ?? r.place) : null;
  if (lugar === 1) return "row win1";
  if (lugar === 2) return "row win2";
  return "row";
}

function renderRows(payload){
  const list = $("list");
  list.innerHTML = "";

  const headers = payload.headers || [];
  const rows = payload.rows || [];

  // Estructura esperada del backend paginado:
  // [folio, telefono_envio, nombre, sel1..sel9, aciertos, (opcional: lugar)]
  // Nosotros NO mostramos tel√©fono, pero s√≠ se usa para buscar.
  const idxFolio = 0;
  const idxTel   = 1;
  const idxNom   = 2;
  const idxAci   = headers.length - 1; // aciertos

  // si el backend manda lugar separado como √∫ltimo, ajustar:
  // (si detecta "lugar" en headers, lo saca)
  let idxLugar = -1;
  const hLow = headers.map(h=>String(h||"").toLowerCase());
  idxLugar = hLow.indexOf("lugar");
  const hasLugar = idxLugar >= 0;

  const parts = [];
  for (let i=0; i<rows.length; i++){
    const r = rows[i] || [];
    const folio = r[idxFolio] ?? "";
    const nombre = r[idxNom] ?? "";
    const aciertos = hasLugar ? (r[idxAci-1] ?? "") : (r[idxAci] ?? "");
    const lugar = hasLugar ? (r[idxLugar] ?? 0) : (r._lugar ?? r.place ?? 0);

    const cls = (lugar===1) ? "row win1" : (lugar===2) ? "row win2" : "row";

    // sels: desde idxNom+1 hasta antes de aciertos (y antes de lugar si existe)
    const end = hasLugar ? (idxAci-1) : idxAci;
    const sels = r.slice(idxNom+1, end).slice(0,9);

    let selsHtml = "";
    for (let k=0; k<9; k++){
      const s = sels[k] ?? "";
      const ok = resultados[k] && norm(s) === resultados[k];
      selsHtml += `<div class="cell"><span class="pill ${ok?'hit':''}">${(s||'-')}</span></div>`;
    }

    parts.push(`
      <div class="${cls}">
        <div class="cell folio">${folio}</div>
        <div class="cell name">${nombre}</div>
        ${selsHtml}
        <div class="cell ac">${aciertos}</div>
      </div>
    `);
  }

  list.innerHTML = parts.join("");
  syncScrollbarWidth();
}

function currentQuery(){
  return $("searchInput").value.trim();
}

async function loadPage(){
  showLoading(true);
  showNoMatch(false);

  try{
    const q = currentQuery();
    const url =
      `${BASE}?mode=clasif&page=${encodeURIComponent(page)}&pageSize=${encodeURIComponent(PAGE_SIZE)}`
      + (q ? `&q=${encodeURIComponent(q)}` : "");

    const res = await fetch(url, {cache:"no-store"});
    const j = await res.json();

    // esperamos: totalPages, totalRows (o totalRecords), headers, rows
    totalPages = Number(j.totalPages || 1);
    totalRows  = Number(j.totalRows ?? j.totalRecords ?? 0);

    // si filtras y no hay filas:
    const rows = j.rows || [];
    showNoMatch(!!currentQuery() && rows.length === 0);

    renderRows(j);
    setPageText();
  }catch(e){
    // si falla, mostramos ‚Äúsin coincidencias‚Äù s√≥lo si hab√≠a b√∫squeda
    showNoMatch(!!currentQuery());
  }finally{
    showLoading(false);
  }
}

/* navegaci√≥n */
$("btnPrev").addEventListener("click", ()=>{
  if (page<=1) return;
  page--; loadPage();
});
$("btnNext").addEventListener("click", ()=>{
  if (page>=totalPages) return;
  page++; loadPage();
});

/* Enter oculta teclado */
$("searchInput").addEventListener("keydown", (e)=>{
  if (e.key === "Enter"){
    e.preventDefault();
    e.target.blur();
  }
});

/* b√∫squeda (con debounce) */
let searchTO = null;
$("searchInput").addEventListener("input", ()=>{
  if (searchTO) clearTimeout(searchTO);
  searchTO = setTimeout(()=>{
    page = 1;
    loadPage();
  }, 180);
});

/* init */
(async ()=>{
  await loadConfig();
  await loadPage();
  setTimeout(syncScrollbarWidth, 0);
})();
</script>

</body>
</html>
