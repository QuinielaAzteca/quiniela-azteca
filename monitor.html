<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiniela Azteca – Monitor</title>

<style>
:root{
  --fg:#0f172a;
  --muted:#475569;
  --bg:#eef6f1;
  --card:#ffffff;
  --line:#d7e6dc;

  --greenWin:#16a34a;
  --greenBg:#dcfce7;

  --yellowWin:#facc15;
  --yellowBg:#fef9c3;

  --pill:#e5e7eb;
}

*{box-sizing:border-box}
html,body{margin:0;height:100%;font-family:system-ui,Segoe UI,Roboto,Arial}
body{
  background:var(--bg);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== HEADER FIJO ===== */
.header{
  position:sticky;
  top:0;
  z-index:20;
  background:#fff;
  border-bottom:1px solid var(--line);
}
.header-inner{
  max-width:900px;
  margin:auto;
  padding:8px 10px;
}

.title{
  font-weight:900;
  font-size:18px;
}
.week{
  font-size:12px;
  color:var(--muted);
  margin-bottom:6px;
}

/* ===== PARTIDOS ===== */
.partidos{
  display:flex;
  flex-direction:column;
  gap:3px;
  font-size:11px;
  margin-bottom:6px;
}
.partido{
  display:flex;
  justify-content:space-between;
  padding:3px 6px;
  background:#f6fbf8;
  border-radius:8px;
}
.partido span:last-child{
  font-weight:800;
}

/* ===== BUSCADOR ===== */
.search{
  position:relative;
}
.search input{
  width:100%;
  padding:7px 10px;
  font-size:14px;
  font-weight:800;
  border-radius:12px;
  border:2px solid #cbd5e1;
  outline:none;
}

/* ===== CONTENEDOR ===== */
.wrap{
  flex:1;
  overflow:auto;
  padding:8px;
}

/* ===== TARJETAS ===== */
.card{
  background:var(--card);
  border:1px solid var(--line);
  border-radius:12px;
  padding:6px 8px;
  margin-bottom:6px;
}

/* ===== FILA SUPERIOR ===== */
.topRow{
  display:flex;
  align-items:baseline;
  gap:6px;
  font-size:11px;
}
.folio{
  font-size:9px;
  color:var(--muted);
}
.nombre{
  font-weight:900;
  font-size:11px;
  flex:1;
}

/* ===== SELECCIONES ===== */
.sels{
  display:flex;
  justify-content:space-between;
  margin-top:4px;
}
.sel{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:1px;
}
.selNum{
  font-size:8px;
  color:var(--muted);
}
.selVal{
  font-size:11px;
  font-weight:900;
  padding:2px 4px;
  border-radius:6px;
  background:#f1f5f9;
}

/* ===== ACIERTOS ===== */
.aciertos{
  display:flex;
  flex-direction:column;
  align-items:center;
}
.aciertos span:first-child{
  font-size:8px;
  color:var(--muted);
}
.aciertos span:last-child{
  font-weight:900;
  font-size:12px;
}

/* ===== GANADORES ===== */
.win1{
  background:var(--greenBg);
  border-color:var(--greenWin);
}
.win2{
  background:var(--yellowBg);
  border-color:var(--yellowWin);
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <div class="header-inner">
    <div class="title">QUINIELA AZTECA</div>
    <div class="week" id="weekTxt"></div>

    <div class="partidos" id="partidosTxt"></div>

    <div class="search">
      <input id="searchInput" placeholder="Buscar por nombre, folio o teléfono">
    </div>
  </div>
</div>

<!-- LISTADO -->
<div class="wrap" id="listado"></div>

<script>
const BASE = "https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";
const ENDPOINT = BASE + "?mode=clasif";
const CONFIG   = BASE + "?mode=config";

let raw = [];

const $ = id => document.getElementById(id);

function renderPartidos(cfg){
  const box = $("partidosTxt");
  box.innerHTML="";
  (cfg.partidos||[]).slice(0,9).forEach((p,i)=>{
    const div=document.createElement("div");
    div.className="partido";
    div.innerHTML=`<span>${i+1} ${p.local} vs ${p.visita}</span>
                   <span>${cfg.marcadores[i]||"-"} ${cfg.resultados[i]||"-"}</span>`;
    box.appendChild(div);
  });
}

function render(rows){
  const cont = $("listado");
  cont.innerHTML="";
  rows.forEach(r=>{
    const card=document.createElement("div");
    card.className="card "+(r._lugar===1?"win1":r._lugar===2?"win2":"");

    const sels = r.sels.map((s,i)=>`
      <div class="sel">
        <div class="selNum">${i+1}</div>
        <div class="selVal">${s||"-"}</div>
      </div>`).join("");

    card.innerHTML=`
      <div class="topRow">
        <div class="folio">#${r.folio}</div>
        <div class="nombre">${r.nombre_show}</div>
      </div>

      <div class="sels">
        ${sels}
        <div class="aciertos">
          <span>A</span>
          <span>${r.aciertos}</span>
        </div>
      </div>
    `;
    cont.appendChild(card);
  });
}

async function load(){
  const cfg = await fetch(CONFIG).then(r=>r.json()).then(j=>j.cfg);
  $("weekTxt").textContent = cfg.subtitulo || "";
  renderPartidos(cfg);

  const res = await fetch(ENDPOINT).then(r=>r.json());
  raw = res.data.rows.map(r=>{
    return {
      folio:r[0],
      telefono:r[1],
      nombre_show:r[2],
      nombre:r[2].toLowerCase(),
      sels:r.slice(3,12),
      aciertos:r[r.length-1],
      _lugar:0
    }
  });

  // lugares
  const acs = raw.map(r=>r.aciertos);
  const max = Math.max(...acs);
  const sec = [...new Set(acs.filter(a=>a<max))].sort((a,b)=>b-a)[0];
  raw.forEach(r=>{
    if(r.aciertos===max) r._lugar=1;
    else if(r.aciertos===sec) r._lugar=2;
  });

  render(raw);
}

$("searchInput").addEventListener("input", e=>{
  const q=e.target.value.toLowerCase();
  if(!q){render(raw);return;}
  render(raw.filter(r=>
    String(r.folio).includes(q) ||
    r.nombre.includes(q) ||
    String(r.telefono).includes(q)
  ));
});

load();
</script>
</body>
</html>
