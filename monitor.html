<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiniela Azteca - Monitor</title>

<style>
html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#eef6f1;color:#0f172a}

/* ===== HEADER FIJO ===== */
.header{
  position:sticky;
  top:0;
  z-index:30;
  background:#ffffffee;
  backdrop-filter:blur(6px);
  border-bottom:1px solid #d7e6dc;
}
.header-inner{
  max-width:980px;
  margin:auto;
  padding:8px 12px;
}
.brand h1{
  margin:0;
  font-size:22px;
  letter-spacing:.04em;
}
.brand .q{color:#0a6b3a;font-weight:900}
.brand .a{color:#c62828;font-weight:900}
.sub{
  font-size:14px;
  font-weight:700;
  color:#475569;
  margin-top:2px;
}
.search{
  margin-top:6px;
  display:flex;
  align-items:center;
  gap:8px;
  background:#fff;
  border:2px solid #cbd5e1;
  border-radius:999px;
  padding:8px 12px;
}
.search input{
  border:0;
  outline:none;
  width:100%;
  font-size:14px;
  font-weight:700;
  background:transparent;
}

/* ===== CONTENEDOR ===== */
.wrap{max-width:980px;margin:auto;padding:10px}

/* ===== PARTIDOS ===== */
.card{
  background:#fff;
  border-radius:14px;
  border:1px solid #d7e6dc;
  margin-bottom:10px;
}
.bar{
  height:6px;
  background:linear-gradient(90deg,#0a6b3a 0 33%,#fff 33% 66%,#c62828 66% 100%);
}
.matches{padding:8px}
.match{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:6px 8px;
  border-radius:10px;
  background:#f6fbf8;
  margin-bottom:6px;
  font-weight:800;
  font-size:14px;
}
.match span{display:flex;gap:6px;align-items:center}
.chip{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
  font-weight:900;
  border:1px solid #d1fae5;
  background:#ecfdf5;
  color:#065f46;
}

/* ===== TABLA ===== */
.table-card{
  background:#fff;
  border-radius:14px;
  border:1px solid #d7e6dc;
  overflow:hidden;
}
.table-title{
  padding:8px 12px;
  font-size:18px;
  font-weight:900;
  border-bottom:1px solid #e5e7eb;
}
table{width:100%;border-collapse:collapse}
thead th{
  position:sticky;
  top:110px;
  background:#f8fafc;
  font-size:11px;
  font-weight:900;
  padding:6px;
  border-bottom:1px solid #e5e7eb;
}
tbody td{
  padding:6px;
  border-bottom:1px solid #eef2f2;
  font-size:12px;
  font-weight:700;
}
tbody tr:nth-child(even){background:#fbfdfc}

/* columnas */
.col-folio{width:44px;text-align:right;font-size:11px;color:#64748b}
.col-nombre{min-width:160px;font-size:12px;font-weight:800}

/* pills */
.pills{display:flex;gap:4px;justify-content:center}
.pill{
  width:26px;height:26px;
  border-radius:999px;
  display:grid;
  place-items:center;
  font-size:12px;
  font-weight:900;
  border:2px solid #cbd5e1;
}
.pill.ok{background:#ecfdf5;border-color:#bbf7d0;color:#065f46}

.badgeA{
  min-width:32px;
  padding:6px 0;
  border-radius:10px;
  text-align:center;
  font-weight:900;
  background:#1d4ed8;
  color:#fff;
  font-size:12px;
}
.badgeA.low{background:#93c5fd;color:#0f172a}
</style>
</head>

<body>

<!-- HEADER FIJO -->
<div class="header">
  <div class="header-inner">
    <div class="brand">
      <h1><span class="q">QUINIELA</span> <span class="a">AZTECA</span></h1>
      <div class="sub" id="subtitulo">â€”</div>
    </div>
    <div class="search">
      ðŸ”Ž
      <input id="q" placeholder="Busca por nombre o folio" autocomplete="off">
    </div>
  </div>
</div>

<div class="wrap">

  <!-- PARTIDOS -->
  <div class="card">
    <div class="bar"></div>
    <div class="matches" id="matches"></div>
  </div>

  <!-- TABLA -->
  <div class="table-card">
    <div class="table-title">CLASIFICACIÃ“N</div>
    <div id="tableWrap"></div>
  </div>

</div>

<script>
/* ========= CONFIG ========= */
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";

let CFG=null,PARTIDOS=[],RESULTADOS=[],MARCADORES=[],TABLE=null;

const $=s=>document.querySelector(s);

async function fetchJSON(u){
  const r=await fetch(u,{cache:'no-store'});
  return await r.json();
}

function renderMatches(){
  const m=$('#matches');
  m.innerHTML=PARTIDOS.map((p,i)=>`
    <div class="match">
      <div>${i+1} ${p.local} vs ${p.visita}</div>
      <span>
        <span class="chip">${MARCADORES[i]||'-'}</span>
        <span class="chip">${RESULTADOS[i]||'-'}</span>
      </span>
    </div>
  `).join('');
}

function renderTable(){
  const w=$('#tableWrap');
  if(!TABLE)return;
  const h=TABLE.headers;
  const r=TABLE.rows;
  const iF=h.indexOf('folio');
  const iN=h.indexOf('nombre');
  const iA=h.indexOf('aciertos');
  const start=iN+1,end=iA-1;

  const q=$('#q').value.toLowerCase();
  const rows=r.filter(x=>{
    const f=String(x[iF]||'').toLowerCase();
    const n=String(x[iN]||'').toLowerCase();
    return f.includes(q)||n.includes(q);
  });

  let html=`<table><thead><tr>
    <th class="col-folio">#</th>
    <th class="col-nombre">Nombre</th>
    ${Array(end-start+1).fill(0).map((_,i)=>`<th>${i+1}</th>`).join('')}
    <th>A</th>
  </tr></thead><tbody>`;

  rows.forEach(x=>{
    html+=`<tr>
      <td class="col-folio">${x[iF]||''}</td>
      <td class="col-nombre">${x[iN]}</td>
      ${x.slice(start,end+1).map((v,i)=>{
        const ok=v===RESULTADOS[i];
        return `<td><div class="pills"><span class="pill ${ok?'ok':''}">${v||'-'}</span></div></td>`;
      }).join('')}
      <td><div class="badgeA ${x[iA]<9?'low':''}">${x[iA]}</div></td>
    </tr>`;
  });

  html+='</tbody></table>';
  w.innerHTML=html;
}

async function load(){
  const cfg=await fetchJSON(ENDPOINT+'?mode=config');
  CFG=cfg.cfg;
  PARTIDOS=CFG.partidos;
  RESULTADOS=CFG.resultados||[];
  MARCADORES=CFG.marcadores||[];
  $('#subtitulo').textContent=CFG.subtitulo||'â€”';
  renderMatches();

  const t=await fetchJSON(ENDPOINT+'?mode=clasif');
  TABLE=t.data;
  renderTable();
}

$('#q').addEventListener('input',renderTable);
load();
</script>
</body>
</html>
