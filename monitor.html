<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiniela Azteca ‚Äì Monitor</title>

<style>
:root{
  --verde:#16a34a;
  --verdeSuave:#dcfce7;
  --azul:#1d4ed8;
  --azulSuave:#93c5fd;

  --bg:#f3f6f4;
  --line:#e5e7eb;
  --txt:#0f172a;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
  background:var(--bg);
  color:var(--txt);
}

/* ===== HEADER ===== */
.header{
  position:sticky;
  top:0;
  z-index:10;
  background:#fff;
  border-bottom:2px solid var(--line);
}

.header-inner{
  max-width:1100px;
  margin:auto;
  padding:8px 12px;
}

.title{
  font-weight:900;
  font-size:18px;
  letter-spacing:.04em;
}
.title .mxg{color:#006847}
.title .mxr{color:#ce1126}

.week{
  font-size:13px;
  font-weight:800;
  margin-top:2px;
}

.partidos{
  margin-top:6px;
  font-size:12px;
  font-weight:800;
  line-height:1.35;
  display:flex;
  flex-direction:column;
  gap:2px;
}

.partidos .p{
  display:flex;
  justify-content:space-between;
  white-space:nowrap;
}

/* ===== BUSCADOR ===== */
.search{
  margin-top:10px;
  position:relative;
}

.search::before{
  content:"üîç";
  position:absolute;
  left:10px;
  top:50%;
  transform:translateY(-50%);
  font-size:14px;
  opacity:.6;
}

.search input{
  width:100%;
  padding:8px 10px 8px 34px;
  font-size:14px;
  font-weight:800;
  border:2px solid #cbd5e1;
  border-radius:12px;
  outline:none;
}

/* ===== TABLA ===== */
.wrap{
  max-width:1100px;
  margin:auto;
  padding:10px 12px 30px;
}

table{
  width:100%;
  border-collapse:separate;
  border-spacing:0;
  table-layout:fixed;
  background:#fff;
  border:1px solid var(--line);
  border-radius:12px;
  overflow:hidden;
}

thead th{
  position:sticky;
  top:0;
  z-index:5;
  background:#f8fafc;
  font-size:10px;
  letter-spacing:.04em;
  padding:4px 4px;
  border-bottom:1px solid var(--line);
}

th,td{
  padding:4px 4px;
  font-size:13px;
  font-weight:900;
  text-align:center;
  border-bottom:1px solid var(--line);
}

/* columnas */
th.col-folio,td.col-folio{
  width:32px;
  font-size:11px;
}

th.col-nombre,td.col-nombre{
  text-align:left;
  width:190px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

th.col-ac,td.col-ac{
  width:32px;
}

/* ===== SELECCIONES ===== */
td.selCell{
  padding:2px 0;
}

.selPill{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:20px;
  height:24px;
  font-size:12px;
  font-weight:900;
  border-radius:12px;
  border:1px solid #cbd5e1;
}

.selHit{
  background:var(--verdeSuave);
  border-color:#86efac;
  color:#064e3b;
}

/* ===== ACIERTOS ===== */
td.col-ac.win1{
  background:var(--azul);
  color:#fff;
}

td.col-ac.win2{
  background:var(--azulSuave);
  color:#0f172a;
}

tbody tr:last-child td{border-bottom:none}
</style>
</head>

<body>

<div class="header">
  <div class="header-inner">
    <div class="title">
      <span class="mxg">QUINIELA</span> <span class="mxr">AZTECA</span>
    </div>
    <div class="week" id="weekTxt"></div>
    <div class="partidos" id="partidosTxt"></div>

    <div class="search">
      <input id="searchInput" placeholder="Busca aqui por telefono, nombre o folio">
    </div>
  </div>
</div>

<div class="wrap">
  <table id="tabla"></table>
</div>

<script>
const BASE = "https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";
const ENDPOINT = BASE + "?mode=clasif";
const CONFIG   = BASE + "?mode=config";

let raw = [];
let resultados = [];
let marcadores = [];

function buildHeader(){
  return `
  <thead>
    <tr>
      <th class="col-folio">#</th>
      <th class="col-nombre">Nombre</th>
      ${[1,2,3,4,5,6,7,8,9].map(n=>`<th>${n}</th>`).join('')}
      <th class="col-ac">A</th>
    </tr>
  </thead>
  <tbody></tbody>`;
}

function norm(v){ return String(v||'').trim().toUpperCase(); }

function render(rows){
  const tbody = document.querySelector("#tabla tbody");
  tbody.innerHTML = "";

  rows.forEach(r=>{
    const tr = document.createElement("tr");

    const sels = r.sels.map((s,i)=>{
      const ok = resultados[i] && norm(s)===norm(resultados[i]);
      return `<td class="selCell">
        <span class="selPill ${ok?'selHit':''}">${s||'-'}</span>
      </td>`;
    }).join("");

    tr.innerHTML = `
      <td class="col-folio">${r.folio}</td>
      <td class="col-nombre">${r.nombre_show}</td>
      ${sels}
      <td class="col-ac ${r._lugar===1?'win1':r._lugar===2?'win2':''}">${r.aciertos}</td>
    `;
    tbody.appendChild(tr);
  });
}

function applyFilter(){
  const q = searchInput.value.toLowerCase();
  render(raw.filter(r =>
    String(r.folio).includes(q) ||
    String(r.telefono).includes(q) ||
    r.nombre.includes(q)
  ));
}

async function load(){
  const cfg = (await fetch(CONFIG).then(r=>r.json())).cfg || {};
  weekTxt.textContent = cfg.subtitulo || "";

  resultados = cfg.resultados||[];
  marcadores = cfg.marcadores||[];

  partidosTxt.innerHTML = "";
  (cfg.partidos||[]).forEach((p,i)=>{
    const div=document.createElement("div");
    div.className="p";
    div.innerHTML=`<span>${i+1} ${p.local} vs ${p.visita}</span><span>${marcadores[i]||'-'} (${resultados[i]||'-'})</span>`;
    partidosTxt.appendChild(div);
  });

  const data = (await fetch(ENDPOINT).then(r=>r.json())).data;
  const h = data.headers.map(x=>x.toLowerCase());

  const iF=h.indexOf("folio"), iN=h.indexOf("nombre"), iT=h.indexOf("telefono_envio"), iA=h.indexOf("aciertos");
  const start=iN+1, end=iA;

  raw = data.rows.map(r=>({
    folio:r[iF],
    telefono:iT>=0?r[iT]:"",
    nombre:r[iN].toLowerCase(),
    nombre_show:r[iN],
    sels:r.slice(start,end).slice(0,9),
    aciertos:r[iA],
    _lugar:0
  }));

  const acs=raw.map(r=>r.aciertos);
  const max=Math.max(...acs);
  const sec=[...new Set(acs)].sort((a,b)=>b-a).find(x=>x<max);

  raw.forEach(r=>{
    if(r.aciertos===max) r._lugar=1;
    else if(sec!=null && r.aciertos===sec) r._lugar=2;
  });

  tabla.innerHTML=buildHeader();
  render(raw);
}

searchInput.addEventListener("input",applyFilter);
load();
setInterval(load,5000);
</script>
</body>
</html>
