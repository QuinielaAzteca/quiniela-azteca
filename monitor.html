<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quiniela Azteca - Monitor</title>

<style>
html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:#eef6f1;color:#0f172a}

/* ===== ALTURAS (para sticky) ===== */
:root{
  --headerH: 78px;     /* header compacto */
  --matchesH: 260px;   /* alto de la caja de partidos (ajustable) */
}

/* ===== HEADER FIJO (COMPACTO) ===== */
.header{
  position:sticky;
  top:0;
  z-index:50;
  background:#ffffffee;
  backdrop-filter:blur(6px);
  border-bottom:1px solid #d7e6dc;
}
.header-inner{
  max-width:980px;
  margin:auto;
  padding:6px 12px; /* m√°s compacto */
}
.brand h1{
  margin:0;
  font-size:20px; /* m√°s compacto */
  letter-spacing:.04em;
  line-height:1.05;
}
.brand .q{color:#0a6b3a;font-weight:900}
.brand .a{color:#c62828;font-weight:900}
.sub{
  font-size:13px;
  font-weight:800;
  color:#475569;
  margin-top:2px;
}
.search{
  margin-top:6px;
  display:flex;
  align-items:center;
  gap:8px;
  background:#fff;
  border:2px solid #cbd5e1;
  border-radius:999px;
  padding:6px 10px; /* m√°s compacto */
}
.search input{
  border:0;
  outline:none;
  width:100%;
  font-size:13px;
  font-weight:800;
  background:transparent;
}

/* ===== CONTENEDOR ===== */
.wrap{max-width:980px;margin:auto;padding:10px}

/* ===== PARTIDOS FIJOS (STICKY) ===== */
.matchesSticky{
  position:sticky;
  top: var(--headerH);   /* se pega justo debajo del header */
  z-index:40;
}

/* ===== CARD BASE ===== */
.card{
  background:#fff;
  border-radius:14px;
  border:1px solid #d7e6dc;
  overflow:hidden;
}
.bar{
  height:6px;
  background:linear-gradient(90deg,#0a6b3a 0 33%,#fff 33% 66%,#c62828 66% 100%);
}

/* ===== PARTIDOS (50% M√ÅS COMPACTO) ===== */
.matches{
  padding:6px;               /* antes 8 */
  max-height: var(--matchesH);
  overflow:auto;             /* por si quieres ver 9 sin estirar todo */
}
.match{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:4px 6px;           /* antes 6 8 */
  border-radius:10px;
  background:#f6fbf8;
  margin-bottom:5px;         /* m√°s compacto */
  font-weight:900;
  font-size:12px;            /* m√°s compacto */
}
.match:nth-child(even){ background:#eff7f2; }
.match span{display:flex;gap:6px;align-items:center}
.chip{
  padding:3px 8px;           /* m√°s compacto */
  border-radius:999px;
  font-size:11px;
  font-weight:900;
  border:1px solid #d1fae5;
  background:#ecfdf5;
  color:#065f46;
  white-space:nowrap;
}

/* ===== TABLA ===== */
.table-card{
  background:#fff;
  border-radius:14px;
  border:1px solid #d7e6dc;
  overflow:hidden;
  margin-top:10px;
}
.table-title{
  padding:8px 12px;
  font-size:16px;
  font-weight:1000;
  border-bottom:1px solid #e5e7eb;
}
table{width:100%;border-collapse:collapse}
thead th{
  position:sticky;
  top: calc(var(--headerH) + var(--matchesH) + 14px); /* header + partidos + margen */
  background:#f8fafc;
  font-size:11px;
  font-weight:900;
  padding:6px;
  border-bottom:1px solid #e5e7eb;
  z-index:10;
}
tbody td{
  padding:6px;
  border-bottom:1px solid #eef2f2;
  font-size:12px;
  font-weight:800;
}
tbody tr:nth-child(even){background:#fbfdfc}

/* columnas */
.col-folio{width:44px;text-align:right;font-size:10px;color:#64748b}
.col-nombre{min-width:160px;font-size:12px;font-weight:900}

/* pills */
.pills{display:flex;gap:4px;justify-content:center}
.pill{
  width:26px;height:26px;
  border-radius:999px;
  display:grid;
  place-items:center;
  font-size:12px;
  font-weight:1000;
  border:2px solid #cbd5e1;
}
.pill.ok{background:#ecfdf5;border-color:#bbf7d0;color:#065f46}

.badgeA{
  min-width:32px;
  padding:6px 0;
  border-radius:10px;
  text-align:center;
  font-weight:1000;
  background:#1d4ed8;
  color:#fff;
  font-size:12px;
}
.badgeA.low{background:#93c5fd;color:#0f172a}

/* ===== Ajuste m√≥vil: recalcular alturas sticky ===== */
@media (max-width:520px){
  :root{
    --headerH: 84px;
    --matchesH: 240px;
  }
}
</style>
</head>

<body>

<!-- HEADER FIJO -->
<div class="header">
  <div class="header-inner">
    <div class="brand">
      <h1><span class="q">QUINIELA</span> <span class="a">AZTECA</span></h1>
      <div class="sub" id="subtitulo">‚Äî</div>
    </div>
    <div class="search">
      üîé
      <input id="q" placeholder="Busca por nombre o folio" autocomplete="off">
    </div>
  </div>
</div>

<div class="wrap">

  <!-- PARTIDOS (AHORA S√ç: STICKY) -->
  <div class="matchesSticky">
    <div class="card">
      <div class="bar"></div>
      <div class="matches" id="matches"></div>
    </div>
  </div>

  <!-- TABLA -->
  <div class="table-card">
    <div class="table-title">CLASIFICACI√ìN</div>
    <div id="tableWrap"></div>
  </div>

</div>

<script>
/* ========= CONFIG ========= */
const ENDPOINT = "https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";

let CFG=null,PARTIDOS=[],RESULTADOS=[],MARCADORES=[],TABLE=null;

const $=s=>document.querySelector(s);

async function fetchJSON(u){
  const r=await fetch(u,{cache:'no-store'});
  return await r.json();
}

function renderMatches(){
  const m=$('#matches');
  m.innerHTML=PARTIDOS.slice(0,9).map((p,i)=>`
    <div class="match">
      <div>${i+1} ${p.local} vs ${p.visita}</div>
      <span>
        <span class="chip">${(MARCADORES[i]||'-') || '-'}</span>
        <span class="chip">${(RESULTADOS[i]||'-') || '-'}</span>
      </span>
    </div>
  `).join('');
}

function renderTable(){
  const w=$('#tableWrap');
  if(!TABLE){ w.innerHTML=''; return; }

  const h=TABLE.headers.map(x=>String(x||'').trim().toLowerCase());
  const r=TABLE.rows||[];

  const iF=h.indexOf('folio');
  const iN=h.indexOf('nombre');
  const iA=h.indexOf('aciertos');

  const start=iN+1, end=iA-1;
  const selCount=Math.max(0,end-start+1);

  const q=$('#q').value.toLowerCase();
  const rows=r.filter(x=>{
    const f=String((iF>=0?x[iF]:'')||'').toLowerCase();
    const n=String((iN>=0?x[iN]:'')||'').toLowerCase();
    return f.includes(q)||n.includes(q);
  });

  let html=`<table><thead><tr>
    <th class="col-folio">#</th>
    <th class="col-nombre">Nombre</th>
    ${Array.from({length: selCount}, (_,i)=>`<th>${i+1}</th>`).join('')}
    <th>A</th>
  </tr></thead><tbody>`;

  rows.forEach(x=>{
    const folio = (iF>=0?x[iF]:'')||'';
    const nombre= (iN>=0?x[iN]:'')||'';
    const aci   = Number((iA>=0?x[iA]:0)||0);

    const sels = selCount ? x.slice(start, start+selCount) : [];
    html+=`<tr>
      <td class="col-folio">${folio}</td>
      <td class="col-nombre">${nombre}</td>
      ${sels.map((v,i)=>{
        const val=String(v||'').trim().toUpperCase() || '-';
        const res=String(RESULTADOS[i]||'').trim().toUpperCase();
        const ok=(res && val !== '-' && val===res);
        return `<td><div class="pills"><span class="pill ${ok?'ok':''}">${val}</span></div></td>`;
      }).join('')}
      <td><div class="badgeA ${aci<9?'low':''}">${aci}</div></td>
    </tr>`;
  });

  html+='</tbody></table>';
  w.innerHTML=html;
}

async function load(){
  const cfg=await fetchJSON(ENDPOINT+'?mode=config');
  CFG=cfg.cfg||{};
  PARTIDOS=(CFG.partidos||[]).slice(0,9);
  RESULTADOS=(CFG.resultados||[]).slice(0,9);
  MARCADORES=(CFG.marcadores||[]).slice(0,9);
  $('#subtitulo').textContent=CFG.subtitulo||'‚Äî';
  renderMatches();

  const t=await fetchJSON(ENDPOINT+'?mode=clasif');
  TABLE=t.data||{headers:[],rows:[]};
  renderTable();
}

$('#q').addEventListener('input',renderTable);
load();
</script>

</body>
</html>
