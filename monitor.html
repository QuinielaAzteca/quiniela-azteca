<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Quiniela Azteca ‚Äì Monitor</title>

<style>
:root{
  --fg:#0f172a;
  --muted:#475569;
  --bg:#eaf3ee;
  --bg2:#dfeee7;
  --card:#ffffff;
  --line:#d7e6dc;
  --l:#0a6b3a;
  --v:#c62828;
  --rowA:#f6fbf8;
  --rowB:#eff7f2;
  --shadow: 0 10px 24px rgba(2, 44, 20, .10);
  --okBg:#ecfdf5;
  --okBd:#bbf7d0;
  --okFg:#065f46;
  --chipBg:#f8fafc;
  --chipBd:#e5e7eb;
  --chipFg:#0f172a;
  --azul1:#1d4ed8;
  --azul2:#93c5fd;
  --pillBorder:#cbd5e1;
  --pillHitBg:#dcfce7;
  --pillHitBd:#86efac;
  --pillHitTx:#064e3b;

  --wFolio:22px;
  --wNombre:200px;
  --wSel:20px;
  --wA:24px;
}

*{box-sizing:border-box}
html,body{height:100%;overflow:hidden}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  background:radial-gradient(1200px 520px at 50% -140px,#fff 0%,var(--bg) 55%,var(--bg2) 100%);
  display:flex;
  flex-direction:column;
}

.header{
  position:sticky;top:0;z-index:50;
  background:#fff;
  border-bottom:1px solid var(--line);
  box-shadow:var(--shadow);
}
.header-inner{max-width:1100px;margin:auto;padding:8px 10px}
.headerCard{border:1px solid var(--line);border-radius:14px;overflow:hidden}
.headerBar{height:6px;background:linear-gradient(90deg,var(--l) 0 33%,#fff 33% 66%,var(--v) 66%)}
.headerCardInner{padding:6px 8px}

.brandRow{display:flex;justify-content:space-between;margin-bottom:6px}
.title{font-weight:1000;font-size:18px}
.title .mxg{color:var(--l)} .title .mxr{color:var(--v)}
.week{font-size:12px;font-weight:900;color:var(--muted)}

.partidos{font-size:10px;font-weight:900;display:flex;flex-direction:column;gap:3px}
.p{display:flex;justify-content:space-between;padding:3px 6px;border-radius:10px;background:var(--rowA)}
.p:nth-child(even){background:var(--rowB)}
.p .left{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.p .right{display:flex;gap:5px}
.chip{padding:2px 6px;border-radius:999px;border:1px solid var(--chipBd);background:var(--chipBg);font-size:10px}
.chip.pick{background:var(--okBg);border-color:var(--okBd);color:var(--okFg)}

.searchRow{margin-top:6px}
.search{position:relative}
.search::before{content:"üîç";position:absolute;left:10px;top:50%;transform:translateY(-50%)}
.search input{
  width:100%;padding:8px 10px 8px 36px;
  font-size:14px;font-weight:900;
  border:2px solid #cbd5e1;border-radius:14px
}

.loadingRow{
  margin-top:6px;padding:6px 10px;
  border:1px solid var(--line);
  border-radius:12px;
  background:#f8fafc;
  font-size:12px;font-weight:800;color:var(--muted)
}
.loadingRow[hidden]{display:none}

.noResults{
  margin:10px;
  padding:10px;
  border:1px dashed var(--line);
  border-radius:12px;
  text-align:center;
  font-weight:800;
  color:var(--muted);
}

.tableHeadRow{margin-top:6px;border:1px solid var(--line);border-radius:12px;overflow:hidden}
.tableHeadGrid{
  display:grid;
  grid-template-columns:var(--wFolio) var(--wNombre) repeat(9,var(--wSel)) var(--wA)
}
.thCell{padding:6px 4px;font-size:11px;font-weight:1000;text-align:center}
.thCell.left{text-align:left}

.wrap{flex:1;overflow:hidden;padding:10px 12px}
.tableBox{
  height:100%;
  overflow:auto;
  border:1px solid var(--line);
  border-radius:14px;
  background:#fff
}
.tableBox::after{content:"";display:block;height:80px}

table{width:100%;table-layout:fixed;border-collapse:separate}
td{padding:4px;text-align:center;font-weight:1000}
td.col-folio{width:var(--wFolio);font-size:7px;text-align:right}
td.col-nombre{width:var(--wNombre);text-align:left;font-size:10px}
td.col-ac{width:var(--wA)}
td.selCell{width:var(--wSel)}

.selPill{
  display:inline-flex;align-items:center;justify-content:center;
  width:18px;height:20px;border-radius:12px;
  border:1px solid var(--pillBorder)
}
.selPill.hit{background:var(--pillHitBg);border-color:var(--pillHitBd)}
td.col-ac.win1{background:var(--azul1);color:#fff}
td.col-ac.win2{background:var(--azul2)}
</style>
</head>

<body>
<div class="header">
  <div class="header-inner">
    <div class="headerCard">
      <div class="headerBar"></div>
      <div class="headerCardInner">

        <div class="brandRow">
          <div class="title"><span class="mxg">QUINIELA</span> <span class="mxr">AZTECA</span></div>
          <div class="week" id="weekTxt"></div>
        </div>

        <div class="partidos" id="partidosTxt"></div>

        <div class="searchRow">
          <div class="search">
            <input id="searchInput" placeholder="Busca aqu√≠ por tel√©fono, nombre o folio">
          </div>
        </div>

        <div class="loadingRow" id="loadingRow" hidden>Cargando listado‚Ä¶</div>

        <div class="tableHeadRow">
          <div class="tableHeadGrid">
            <div class="thCell">#</div><div class="thCell left">Nombre</div>
            <div class="thCell">1</div><div class="thCell">2</div><div class="thCell">3</div>
            <div class="thCell">4</div><div class="thCell">5</div><div class="thCell">6</div>
            <div class="thCell">7</div><div class="thCell">8</div><div class="thCell">9</div>
            <div class="thCell">A</div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="tableBox" id="tableBox">
    <table id="tabla"></table>
    <div id="noResults" class="noResults" hidden>Sin coincidencias</div>
  </div>
</div>

<script>
const BASE="https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";
const ENDPOINT=BASE+"?mode=clasif";
const CONFIG=BASE+"?mode=config";

let raw=[],resultados=[],marcadores=[],lastCfgSig="",isLoading=false;
const $=id=>document.getElementById(id);

function showLoading(){$("loadingRow").hidden=false}
function hideLoading(){$("loadingRow").hidden=true}
function sigCfg(c){return JSON.stringify(c||{})}
function norm(v){return String(v??"").toUpperCase()}
function buildBody(){return "<tbody></tbody>"}

function render(rows){
  const tbody=document.querySelector("#tabla tbody");
  tbody.innerHTML="";
  $("noResults").hidden=rows.length>0;
  rows.forEach(r=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td class="col-folio">${r.folio}</td>
      <td class="col-nombre">${r.nombre_show}</td>
      ${r.sels.map((s,i)=>`<td class="selCell"><span class="selPill ${norm(s)==norm(resultados[i])?"hit":""}">${s||"-"}</span></td>`).join("")}
      <td class="col-ac ${r._lugar==1?"win1":r._lugar==2?"win2":""}">${r.aciertos}</td>
    `;
    tbody.appendChild(tr);
  });
}

function applyFilter(){
  const q=$("searchInput").value.toLowerCase().trim();
  if(!q){render(raw);return}
  render(raw.filter(r=>
    String(r.folio).includes(q)||
    r.nombre.includes(q)||
    String(r.telefono).includes(q)
  ));
}

async function load(){
  if(isLoading)return;
  isLoading=true;
  showLoading();
  try{
    const [cfgRes,res]=await Promise.all([
      fetch(CONFIG,{cache:"no-store"}).then(r=>r.json()),
      fetch(ENDPOINT,{cache:"no-store"}).then(r=>r.json())
    ]);

    const cfg=cfgRes.cfg||{};
    const sig=sigCfg(cfg);
    if(sig!==lastCfgSig){
      lastCfgSig=sig;
      $("weekTxt").textContent=cfg.subtitulo||"";
      resultados=(cfg.resultados||[]).slice(0,9);
      marcadores=(cfg.marcadores||[]).slice(0,9);
    }

    const h=(res.data.headers||[]).map(x=>x.toLowerCase());
    const iF=h.indexOf("folio"),iN=h.indexOf("nombre"),iT=h.indexOf("telefono_envio"),iA=h.indexOf("aciertos");
    raw=(res.data.rows||[]).map(r=>{
      const n=String(r[iN]||"").trim();
      return{
        folio:r[iF],
        telefono:iT>=0?r[iT]:"",
        nombre:n.toLowerCase(),
        nombre_show:n,
        sels:r.slice(iN+1,iA).slice(0,9),
        aciertos:r[iA],
        _lugar:0
      };
    });
    render(raw);
  }catch(e){console.error(e)}
  finally{hideLoading();isLoading=false}
}

$("searchInput").addEventListener("input",applyFilter);
$("searchInput").addEventListener("keydown",e=>{if(e.key==="Enter")e.target.blur()});

load();
</script>
</body>
</html>
