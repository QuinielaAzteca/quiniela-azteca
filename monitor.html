<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="format-detection" content="telephone=no,date=no,email=no,address=no" />
<title>Quiniela Azteca â€“ ClasificaciÃ³n</title>

<style>
  :root{
    --bg:#eef6f1;
    --card:#ffffff;
    --line:#cfe5da;
    --text:#0f172a;
    --muted:#64748b;

    --hit:#16a34a;      /* verde semÃ¡foro */
    --hitBorder:#0f7a36;

    /* tamaÃ±os base */
    --wFolio: 60px;
    --wAci:   34px;
    --wSel:   28px;
    --pill:   26px;
    --pillFs: 13px;

    --sbw: 0px; /* scrollbar width */
  }

  *{ box-sizing:border-box; }
  html{ -webkit-text-size-adjust:100%; text-size-adjust:100%; }
  body{
    margin:0;
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    background:var(--bg);
    color:var(--text);
    overflow-x:hidden;
  }

  .app{ min-height:100vh; display:flex; flex-direction:column; }

  .top{
    position:sticky; top:0; z-index:50;
    background:rgba(238,246,241,.92);
    backdrop-filter: blur(8px);
    border-bottom:1px solid var(--line);
  }
  .topInner{
    padding:10px 10px 8px;
    max-width: 980px;
    margin:0 auto;
  }

  .title{ font-weight:900; font-size:18px; line-height:1.1; }
  .week{ font-weight:800; color:var(--muted); font-size:13px; margin-top:2px; }

  .partidosCard{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:18px;
    overflow:hidden;
    box-shadow:0 10px 24px rgba(2,6,23,.05);
    margin:8px 0 10px;
  }
  .p{
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    padding:7px 10px;
    border-bottom:1px solid rgba(207,229,218,.65);
    font-size:12px; line-height:1.15;
    text-decoration:none !important;
  }
  .p:last-child{ border-bottom:none; }
  .p *{ text-decoration:none !important; }

  .p .left{
    font-weight:800;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .p .right{ display:flex; gap:6px; align-items:center; flex:0 0 auto; }
  .chip{
    padding:4px 9px;
    border-radius:999px;
    border:2px solid rgba(148,163,184,.35);
    background:#f8fafc;
    font-weight:900;
    font-size:12px;
    min-width:44px;
    text-align:center;
  }
  .chip.pick{
    border-color:rgba(34,197,94,.25);
    background:rgba(34,197,94,.10);
    color:#065f46;
    min-width:38px;
  }

  .controls{ display:flex; flex-direction:column; gap:8px; }

  .search{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:22px;
    padding:10px 12px;
    display:flex; align-items:center; gap:10px;
    box-shadow:0 10px 24px rgba(2,6,23,.04);
  }
  .search .icon{ font-size:18px; opacity:.65; }
  .search input{
    border:none; outline:none; width:100%;
    font-size:16px; font-weight:800;
    background:transparent;
  }
  .search input::placeholder{ color:#6b7280; font-weight:800; }

  .navCard{
    background:var(--card);
    border:1px solid var(--line);
    border-radius:22px;
    padding:10px 12px;
    display:flex; align-items:center; justify-content:space-between; gap:10px;
    box-shadow:0 10px 24px rgba(2,6,23,.04);
  }
  .navText{ font-weight:900; font-size:18px; line-height:1.05; }
  .navText small{ display:block; font-size:12px; font-weight:800; color:var(--muted); margin-top:2px; }
  .navBtns{ display:flex; gap:10px; align-items:center; }
  .btn{
    width:58px; height:48px;
    border-radius:18px;
    border:2px solid rgba(148,163,184,.35);
    background:#fff;
    font-size:26px;
    font-weight:900;
    display:flex; align-items:center; justify-content:center;
    padding:0;
  }
  .btn:disabled{ opacity:.35; }

  /* HEADER FIJO: usa minmax para que el nombre nunca muera */
  .tableHead{
    margin-top:10px;
    background:var(--card);
    border:1px solid var(--line);
    border-radius:22px;
    overflow:hidden;
    box-shadow:0 10px 24px rgba(2,6,23,.04);
  }
  .tableHeadGrid{
    display:grid;
    grid-template-columns: var(--wFolio) minmax(130px,1fr) repeat(9, var(--wSel)) var(--wAci);
    padding-right: var(--sbw);
  }
  .th{
    padding:10px 6px;
    border-right:1px solid rgba(207,229,218,.7);
    font-weight:900;
    font-size:12px;
    display:flex; align-items:center; justify-content:center;
    background:#f6fbf8;
  }
  .th.left{ justify-content:flex-start; padding-left:12px; font-size:13px; }
  .th:last-child{ border-right:none; }

  .listWrap{
    flex:1 1 auto;
    max-width:980px;
    width:100%;
    margin:0 auto;
    padding:10px 10px 18px;
    overflow:hidden;
  }
  .listBox{
    overflow:auto;
    border-radius:22px;
    background:var(--card);
    border:1px solid var(--line);
    box-shadow:0 10px 24px rgba(2,6,23,.05);
  }

  .row{
    display:grid;
    grid-template-columns: var(--wFolio) minmax(130px,1fr) repeat(9, var(--wSel)) var(--wAci);
    align-items:center;
    border-bottom:1px solid rgba(226,238,232,.9);
    min-height:54px;
  }
  .row:last-child{ border-bottom:none; }

  /* 1Â° y 2Â° en grises */
  .row.win1{ background:#f3f4f6; }
  .row.win2{ background:#e5e7eb; }

  .cell{
    padding:10px 6px;
    display:flex; align-items:center; justify-content:center;
    font-weight:900;
  }
  .cell.folio{ justify-content:flex-start; padding-left:12px; color:#334155; font-size:13px; }
  .cell.name{
    justify-content:flex-start;
    font-size:16px;
    font-weight:1000;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
    letter-spacing:.2px;
  }

  .pill{
    width:var(--pill);
    height:var(--pill);
    border-radius:999px;
    display:flex; align-items:center; justify-content:center;
    border:2px solid rgba(148,163,184,.35);
    background:#fff;
    font-size:var(--pillFs);
    font-weight:1000;
  }
  .pill.hit{
    background:var(--hit);
    border-color:var(--hitBorder);
    color:#fff;
  }

  /* aciertos sin cÃ­rculo */
  .cell.ac{ font-size:18px; font-weight:1000; }
  .cell.ac.good{ color:var(--hit); }

  .msg{ padding:14px 12px; color:#475569; font-weight:800; font-size:14px; }
  .msg.center{ text-align:center; }

  /* telÃ©fonos MUY angostos */
  @media (max-width:380px){
    :root{
      --wFolio: 54px;
      --wAci:   32px;
      --wSel:   26px;
      --pill:   24px;
      --pillFs: 12px;
    }
    .cell.name{ font-size:15px; }
    .btn{ width:54px; height:46px; }
    .navText{ font-size:17px; }
  }
</style>
</head>

<body>
<div class="app">

  <div class="top" id="topBar">
    <div class="topInner">

      <div class="title">QUINIELA AZTECA</div>
      <div class="week" id="weekTxt">â€”</div>

      <div class="partidosCard">
        <div id="partidosTxt"></div>
      </div>

      <div class="controls">
        <div class="search">
          <div class="icon">ðŸ”Ž</div>
          <input id="searchInput" type="text" inputmode="search"
                 placeholder="Busca aquÃ­ por telÃ©fono, nombre o folio" autocomplete="off" />
        </div>

        <div class="navCard">
          <div class="navText" id="navText">
            PÃ¡gina 1 / 1
            <small id="totalTxt">0 registros</small>
          </div>
          <div class="navBtns">
            <button class="btn" id="btnPrev" aria-label="Anterior">â€¹</button>
            <button class="btn" id="btnNext" aria-label="Siguiente">â€º</button>
          </div>
        </div>

        <div class="tableHead">
          <div class="tableHeadGrid" id="headGrid">
            <div class="th left">#</div>
            <div class="th left">Nombre</div>
            <div class="th">1</div><div class="th">2</div><div class="th">3</div><div class="th">4</div><div class="th">5</div>
            <div class="th">6</div><div class="th">7</div><div class="th">8</div><div class="th">9</div>
            <div class="th">Ac</div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="listWrap">
    <div class="listBox" id="listBox">
      <div class="msg center" id="loadingMsg">Cargandoâ€¦</div>
      <div id="list"></div>
      <div class="msg center" id="noMatchMsg" hidden>No hay coincidencias.</div>
    </div>
  </div>

</div>

<script>
const BASE = "https://script.google.com/macros/s/AKfycbyGqoqBpUMbf34qt3cMBbvlsCuf-PXqK8Dvhv7Vzj4dgzNT9pBJ0-_UHkc-IvnPqZ1Y/exec";
const PAGE_SIZE = 500;

let page = 1;
let totalPages = 1;
let totalRows = 0;

let resultados = Array(9).fill("");
let marcadores = Array(9).fill("");

const $ = (id) => document.getElementById(id);
function showLoading(on){ $("loadingMsg").hidden = !on; }
function showNoMatch(on){ $("noMatchMsg").hidden = !on; }
function norm(v){ return String(v ?? "").trim().toUpperCase(); }

function syncScrollbarWidth(){
  const box = $("listBox");
  if (!box) return;
  const sbw = box.offsetWidth - box.clientWidth;
  document.documentElement.style.setProperty("--sbw", sbw + "px");
}
function fitListHeight(){
  const top = $("topBar");
  const list = $("listBox");
  if (!top || !list) return;
  const topH = top.getBoundingClientRect().height;
  const h = Math.max(220, window.innerHeight - topH - 18);
  list.style.height = h + "px";
  list.style.maxHeight = h + "px";
  syncScrollbarWidth();
}
window.addEventListener("resize", ()=>{ fitListHeight(); }, {passive:true});

function setNavText(){
  $("navText").firstChild.nodeValue = `PÃ¡gina ${page} / ${totalPages}`;
  $("totalTxt").textContent = `${Number(totalRows||0).toLocaleString("es-MX")} registros`;
  $("btnPrev").disabled = (page <= 1);
  $("btnNext").disabled = (page >= totalPages);
}

function renderPartidos(cfg){
  const partidos = (cfg.partidos || []).slice(0,9);
  const box = $("partidosTxt");
  box.innerHTML = "";
  partidos.forEach((p,i)=>{
    const m = (marcadores[i] && String(marcadores[i]).trim()) ? String(marcadores[i]).trim() : "-";
    const r = (resultados[i] && String(resultados[i]).trim()) ? String(resultados[i]).trim().toUpperCase() : "-";
    const div = document.createElement("div");
    div.className = "p";
    div.innerHTML = `
      <span class="left">${i+1} ${p.local} vs ${p.visita}</span>
      <span class="right">
        <span class="chip">${m}</span>
        <span class="chip pick">${r}</span>
      </span>
    `;
    box.appendChild(div);
  });
}

async function loadConfig(){
  try{
    const res = await fetch(`${BASE}?mode=config`, {cache:"no-store"});
    const j = await res.json();
    const cfg = (j && j.cfg) ? j.cfg : {};
    $("weekTxt").textContent = cfg.subtitulo || "";
    resultados = (cfg.resultados || []).slice(0,9).map(norm);
    marcadores = (cfg.marcadores || []).slice(0,9);
    renderPartidos(cfg);
  }catch(e){}
}

function currentQuery(){ return $("searchInput").value.trim(); }

function renderRows(data){
  const list = $("list");
  list.innerHTML = "";

  const headers = data.headers || [];
  const rows = data.rows || [];

  const hLow = headers.map(h=>String(h||"").toLowerCase());
  const idxFolio = hLow.indexOf("folio");
  const idxNom   = hLow.indexOf("nombre");
  const idxAci   = hLow.indexOf("aciertos");
  const idxLugar = hLow.indexOf("lugar"); // puede venir o no

  rows.forEach(r=>{
    const folio = (idxFolio>=0 ? r[idxFolio] : r[0]) ?? "";
    const nombre = (idxNom>=0 ? r[idxNom] : r[2]) ?? "";
    const aciertos = (idxAci>=0 ? r[idxAci] : r[12]) ?? 0;
    const lugar = (idxLugar>=0 ? r[idxLugar] : r[r.length-1]) ?? 0;

    const cls = (lugar===1) ? "row win1" : (lugar===2) ? "row win2" : "row";
    const sels = r.slice(idxNom+1, idxNom+1+9);

    const rowDiv = document.createElement("div");
    rowDiv.className = cls;
    rowDiv.innerHTML = `
      <div class="cell folio">${folio}</div>
      <div class="cell name">${String(nombre).toUpperCase()}</div>
      ${sels.map((s,i)=>{
        const v = norm(s || "-");
        const ok = resultados[i] && v === resultados[i];
        return `<div class="cell"><span class="pill ${ok?'hit':''}">${v}</span></div>`;
      }).join("")}
      <div class="cell ac ${Number(aciertos)>0?'good':''}">${aciertos}</div>
    `;
    list.appendChild(rowDiv);
  });

  syncScrollbarWidth();
}

async function loadPage(){
  showLoading(true);
  showNoMatch(false);

  try{
    const q = currentQuery();
    const url =
      `${BASE}?mode=clasif&page=${encodeURIComponent(page)}&pageSize=${encodeURIComponent(PAGE_SIZE)}`
      + (q ? `&q=${encodeURIComponent(q)}` : "");

    const res = await fetch(url, {cache:"no-store"});
    const j = await res.json();

    // backend actual: j.data contiene todo
    const data = j && j.data ? j.data : null;
    if (!data) throw new Error("Sin data");

    totalPages = Number(data.totalPages || 1);
    totalRows  = Number(data.totalRows ?? 0);

    showNoMatch(!!q && (data.rows || []).length === 0);

    renderRows(data);
    setNavText();
    fitListHeight();
  }catch(e){
    showNoMatch(!!currentQuery());
  }finally{
    showLoading(false);
  }
}

$("btnPrev").addEventListener("click", ()=>{ if (page>1){ page--; loadPage(); }});
$("btnNext").addEventListener("click", ()=>{ if (page<totalPages){ page++; loadPage(); }});

$("searchInput").addEventListener("keydown", (e)=>{
  if (e.key === "Enter"){ e.preventDefault(); e.target.blur(); }
});

let searchTO=null;
$("searchInput").addEventListener("input", ()=>{
  if (searchTO) clearTimeout(searchTO);
  searchTO = setTimeout(()=>{ page=1; loadPage(); }, 220);
});

(async ()=>{
  await loadConfig();
  await loadPage();
  setTimeout(()=>{ fitListHeight(); syncScrollbarWidth(); }, 0);
})();
</script>
</body>
</html>
